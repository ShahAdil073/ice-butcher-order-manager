<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tasks | Ice Butcher Dashboard</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="../node_modules/bootstrap-icons/font/bootstrap-icons.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar will be loaded here -->
    <div id="sidebar-container"></div>

    <!-- Main content -->
    <main class="main-content">
      <!-- Header will be loaded here -->
      <div id="header-container"></div>

      <div class="row my-4">
        <div class="col-lg-8">
          <div class="card">
            <div class="card-body">
              <h2 class="mb-3">Sacred Spiral Sculpt</h2>
              <p class="text-muted">
                A highly intricate sculpture design featuring organic and spiked elements, blending futuristic and surreal aesthetics. The form appears to be inspired by fluid motion and biomechanical structures.
              </p>

              <div class="row mt-4">
                <div class="col-md-6">
                  <div class="mb-3">
                    <h6 class="text-muted mb-2">Status</h6>
                    <span class="badge bg-warning text-dark px-3 py-2 rounded-pill">Ongoing</span>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <h6 class="text-muted mb-2">Assigned To:</h6>
                    <div class="d-flex align-items-center">
                      <img src="assets/images/user.jpg" alt="User Avatar" class="user-avatar me-2">
                      <span>Sebastian Nelson</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row mt-2">
                <div class="col-md-6">
                  <div class="mb-3">
                    <h6 class="text-muted mb-2">Start Date:</h6>
                    <span>12 March, 2025</span>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <h6 class="text-muted mb-2">Due Date:</h6>
                    <span>16 March, 2025</span>
                  </div>
                </div>
              </div>

              <div class="row mt-2">
                <div class="col-md-6">
                  <div class="mb-3">
                    <h6 class="text-muted mb-2">Priority:</h6>
                    <span class="badge bg-success px-3 py-2 rounded-pill">Low</span>
                  </div>
                </div>
              </div>

              <ul class="nav nav-tabs mt-4" id="taskTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="attachment-tab" data-bs-toggle="tab" data-bs-target="#attachment" type="button" role="tab" aria-controls="attachment" aria-selected="true">Attachment</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="comments-tab" data-bs-toggle="tab" data-bs-target="#comments" type="button" role="tab" aria-controls="comments" aria-selected="false">Comments</button>
                </li>
              </ul>

              <div class="tab-content p-3" id="taskTabsContent">
                <div class="tab-pane fade show active" id="attachment" role="tabpanel" aria-labelledby="attachment-tab">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <img src="assets/images/sculpt1.jpg" alt="Sculpture" class="img-fluid rounded">
                    </div>
                    <div class="col-md-6 mb-3">
                      <div class="row">
                        <div class="col-md-12 mb-3">
                          <img src="assets/images/sculpt2.jpg" alt="Sculpture" class="img-fluid rounded">
                        </div>
                        <div class="col-md-12">
                          <img src="assets/images/sculpt3.jpg" alt="Sculpture" class="img-fluid rounded">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-flex justify-content-end mt-4">
                    <button class="btn btn-outline-primary" id="uploadDocBtn">Upload document</button>
                  </div>
                </div>
                <div class="tab-pane fade" id="comments" role="tabpanel" aria-labelledby="comments-tab">
                  <div class="comments-container">
                    <div class="mb-3">
                      <textarea class="form-control" rows="3" placeholder="Add a comment..."></textarea>
                      <div class="d-flex justify-content-end mt-2">
                        <button class="btn btn-primary">Post Comment</button>
                      </div>
                    </div>
                    <div class="comment-list">
                      <div class="comment d-flex mb-3">
                        <img src="assets/images/avatar1.png" alt="User Avatar" class="user-avatar me-3">
                        <div class="comment-content">
                          <h6 class="mb-0">Marie Siray</h6>
                          <p class="text-muted small">2 days ago</p>
                          <p>The design looks amazing! Can we add some more details on the top part?</p>
                        </div>
                      </div>
                      <div class="comment d-flex mb-3">
                        <img src="assets/images/user.jpg" alt="User Avatar" class="user-avatar me-3">
                        <div class="comment-content">
                          <h6 class="mb-0">Sebastian Nelson</h6>
                          <p class="text-muted small">1 day ago</p>
                          <p>I'll work on adding those details. What do you think about making it slightly taller?</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="card-title mb-0">Project Stats</h5>
            </div>
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <i class="bi bi-alarm me-2"></i>
                <div class="flex-grow-1">
                  <h6 class="mb-0">Time Remaining</h6>
                  <small class="text-muted">4d</small>
                </div>
              </div>

              <div class="form-check form-switch mb-3">
                <input class="form-check-input" type="checkbox" id="reminderSwitch">
                <label class="form-check-label" for="reminderSwitch">Activate Reminder</label>
              </div>

              <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <h6 class="mb-0">Progress</h6>
                  <span>60%</span>
                </div>
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: 60%;" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Files</h5>
            </div>
            <div class="card-body">
              <div class="file-item">
                <i class="bi bi-file-earmark-text file-icon"></i>
                <div class="file-info">
                  <h6 class="file-name mb-0">Sacred_Spiral_Sculpt.cnc</h6>
                  <small class="file-size">45.6mb</small>
                </div>
                <div class="file-actions">
                  <button class="btn btn-sm btn-outline-primary"><i class="bi bi-download"></i></button>
                  <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-three-dots"></i></button>
                </div>
              </div>
            </div>
          </div>

          <div class="card mt-4">
            <div class="card-header">
              <h5 class="card-title mb-0">Created By</h5>
            </div>
            <div class="card-body">
              <div class="d-flex align-items-center">
                <img src="assets/images/user.jpg" alt="User Avatar" class="user-avatar me-3">
                <div>
                  <h6 class="mb-0">Sebastian Nelson</h6>
                  <small class="text-muted">Project Manager</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Alert container for notifications -->
  <div class="alert-container position-fixed bottom-0 end-0 p-3" style="z-index: 1050;"></div>

  <!-- Image Modal & Slider -->
  <div class="modal fade" id="taskImageModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content rounded-4" style="background: #fff; border: none; max-width: 900px; margin: auto;">
              <div class="modal-header border-0 pb-0">
                  <img src="assets/images/logo.png" alt="Logo" style="max-width: 80px; margin-bottom: 10px;">
                  <button type="button" class="btn-close ms-auto" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body d-flex align-items-center justify-content-center" style="min-height: 440px;">
                <div class="row w-100">
                  <div class="col-md-10 d-flex align-items-center justify-content-center">
                    <img id="main-modal-img" src="" alt="Preview" style="max-width:100%;max-height:64vh;object-fit:contain;box-shadow:0 4px 20px rgba(0,0,0,0.14);border-radius:14px;">
                  </div>
                  <div class="col-md-2">
                    <div id="modal-slider-thumbs" class="d-flex flex-column gap-3">
                      <!-- Thumbnails injected here -->
                    </div>
                  </div>
                </div>
              </div>
          </div>
      </div>
  </div>

 <!-- Upload Modal -->
  <div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content rounded-4">
        <div class="modal-header border-0 pb-0">
          <h5 class="modal-title ps-1">Upload files</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body pt-0 px-4">
          <div class="text-secondary mb-4 ps-1">Select and upload the files of your choice</div>
          <hr>
          <h6 class="fw-semibold mt-3">Upload Renderings</h6>
          <div class="upload-drag-area my-3 rounded-4 border px-0 py-5 text-center position-relative" style="border:2px dashed #D3D6E3;height:180px;">
            <div class="upload-icon mb-2"><i class="bi bi-cloud-arrow-up" style="font-size:2.5rem;color:#CDD0E3"></i></div>
            <div class="fw-semibold" style="font-size:1rem;">Choose a file or drag & drop it here</div>
            <div style="color:#A6A8B6">JPEG, PNG, PDG, and MP4 formats, up to 50MB</div>
            <input type="file" accept=".pdf,.jpg,.png,.jpeg,.mp4" multiple style="opacity:0;width:100%;height:100%;position:absolute;top:0;left:0;cursor:pointer;" id="renderUploadInput">
            <button class="btn btn-light mt-3 px-4 py-2 rounded-5" onclick="document.getElementById('renderUploadInput').click()">Browse File</button>
          </div>
          <h6 class="fw-semibold mt-4">Upload CNC Files</h6>
          <div class="upload-drag-area my-3 rounded-4 border px-0 py-5 text-center position-relative" style="border:2px dashed #D3D6E3;height:180px;">
            <div class="upload-icon mb-2"><i class="bi bi-cloud-arrow-up" style="font-size:2.5rem;color:#CDD0E3"></i></div>
            <div class="fw-semibold" style="font-size:1rem;">Choose a file or drag & drop it here</div>
            <div style="color:#A6A8B6">JPEG, PNG, PDG, and MP4 formats, up to 50MB</div>
            <input type="file" accept=".pdf,.jpg,.png,.jpeg,.mp4" multiple style="opacity:0;width:100%;height:100%;position:absolute;top:0;left:0;cursor:pointer;" id="cncUploadInput">
            <button class="btn btn-light mt-3 px-4 py-2 rounded-5" onclick="document.getElementById('cncUploadInput').click()">Browse File</button>
          </div>
          <div id="uploadedFilesList"></div>
        </div>
      </div>
    </div>
  </div>



  <!-- JavaScript Dependencies -->
  <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../node_modules/chart.js/dist/chart.umd.js"></script>

  <!-- Custom JS -->
  <script src="assets/js/components.js"></script>
  <script src="assets/js/main.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    // Image Modal/Slider
    const modal = new bootstrap.Modal(document.getElementById('taskImageModal'));
    const images = Array.from(document.querySelectorAll('#attachment img'));
    const mainImg = document.getElementById('main-modal-img');
    const thumbsBox = document.getElementById('modal-slider-thumbs');
    images.forEach(img => {
      img.style.cursor = 'zoom-in';
      img.addEventListener('click', () => {
        updateModalImages(img.src);
        modal.show();
      });
    });
    function updateModalImages(activeSrc) {
      mainImg.src = activeSrc;
      thumbsBox.innerHTML = images.map(im => `<img src="${im.src}" class="rounded thumb-img mb-1" style="max-width:100px;max-height:120px;object-fit:contain;border:2px solid ${im.src===activeSrc?'#2196f3':'#ddd'};cursor:pointer;">`).join('');
      Array.from(thumbsBox.children).forEach((thumb,idx) => {
        thumb.addEventListener('click', () => {
          mainImg.src = images[idx].src;
          updateModalImages(images[idx].src);
        });
      });
    }
    // Upload Areas Logic
    function fileUploadHandler(boxId, inputId, listId) {
      const box = document.getElementById(boxId);
      const input = document.getElementById(inputId);
      const list = document.getElementById(listId);
      box.addEventListener('click',()=>input.click());
      box.addEventListener('dragover',e=>{e.preventDefault(); box.classList.add('drag');});
      box.addEventListener('dragleave',()=>box.classList.remove('drag'));
      box.addEventListener('drop',e=>{
        e.preventDefault(); box.classList.remove('drag');
        input.files = e.dataTransfer.files; input.dispatchEvent(new Event('change'));
      });
      input.addEventListener('change',()=>{
        Array.from(input.files).forEach(file=>{
          const fileId = `${file.name}-${Date.now()}`;
          const ext = file.name.split('.').pop().toLowerCase();
          const isPDF = ext==='pdf';
          const icon = isPDF?'<span class="badge bg-danger me-2">PDF</span>':'<i class="bi bi-file-earmark-image me-2"></i>';
          const size = Math.round(file.size/1024)+ ' KB';
          const row = document.createElement('div');
          row.className = 'file-item mb-2 align-items-center d-flex justify-content-between';
          row.innerHTML = `
            <span>${icon}${file.name}</span>
            <span class="text-muted small">0 KB of ${size} 3 <span class="text-info">Uploading...</span></span>
            <div class="flex-fill px-3"><div class="progress" style="height:6px"><div class="progress-bar" style="width: 0%"></div></div></div>
            <button class="btn btn-outline-danger btn-sm"><i class="bi bi-x"></i></button>
          `;
          list.appendChild(row);
          // Fake upload progress
          let loaded = 0; let interval = setInterval(()=> {
            loaded+=Math.random()*20+12;
            let percent = Math.min(100, (loaded*1024/file.size)*100);
            if(percent>=100){ percent=100; clearInterval(interval);
              row.querySelector('.progress-bar').style.width = '100%';
              row.querySelector('span.text-info').textContent='Completed';
              row.querySelector('span.text-muted').textContent=`${size} Completed`;
              row.querySelector('.btn-outline-danger').outerHTML='<button class="btn btn-outline-secondary btn-sm"><i class="bi bi-trash"></i></button>';
            } else {
              row.querySelector('.progress-bar').style.width= percent+'%';
              row.querySelector('span.text-muted').innerHTML=`${Math.round((percent/100)*file.size/1024)} KB of ${size} 3 <span class='text-info'>Uploading...</span>`;
            }
          }, 180);
        });
      });
    }
    fileUploadHandler('render-upload-box','render-file-input','render-upload-list');
    fileUploadHandler('cnc-upload-box','cnc-file-input','cnc-upload-list');
  });

  
// Upload Modal Logic
const uploadDocBtn = document.getElementById('uploadDocBtn');
const uploadModal = document.getElementById('uploadModal');
const uploadedFilesList = document.getElementById('uploadedFilesList');
function handleFilesUpload(input) {
  [...input.files].forEach(f=>simulateUpload(f));
}
function simulateUpload(file) {
  const id = 'up'+Math.random().toString().slice(2);
  let typeIcon = /pdf/i.test(file.name)?'<img src="https://same-assets.com/icons/pdf.svg" style="width:32px">':'<i class="bi bi-file-earmark-image" style="font-size:2em;color:#2684FF;"></i>';
  let el = document.createElement('div');
  el.className = 'file-upload-bar my-3 py-2 px-3 border rounded d-flex align-items-center';
  el.id = id;
  el.innerHTML = `
    <div class='me-3'>${typeIcon}</div>
    <div class='flex-grow-1'>
      <div class='d-flex justify-content-between align-items-center'>
        <div class='fw-semibold'>${file.name}</div>
        <small class='text-muted'><span class='file-upload-size'>0 KB of ${Math.ceil(file.size/1024)} KB</span>
         <span class='file-upload-status text-info ms-2'>Uploading...</span></small>
      </div>
      <div class='progress my-2' style='height:7px;'>
        <div class='progress-bar' style='width:0%'></div>
      </div>
    </div>
    <div class='ms-2'>
      <button class='btn btn-sm btn-outline-danger' onclick="document.getElementById('${id}').remove()"><i class='bi bi-x'></i></button>
    </div>
  `;
  uploadedFilesList.appendChild(el);
  let uploaded = 0, total = Math.ceil(file.size/1024), bar = el.querySelector('.progress-bar'), stat = el.querySelector('.file-upload-status'), sizeEl = el.querySelector('.file-upload-size');
  let interval = setInterval(()=>{
    uploaded += Math.ceil(total/30);
    if(uploaded>=total) { uploaded=total; stat.innerHTML='Completed <span style="color:#28b76b">●</span>'; clearInterval(interval); }
    sizeEl.textContent = `${uploaded} KB of ${total} KB`;
    bar.style.width = `${Math.round(100*uploaded/total)}%`;
  },80);
}
window.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('renderUploadInput').onchange = function(){handleFilesUpload(this)};
  document.getElementById('cncUploadInput').onchange = function(){handleFilesUpload(this)};
});
if(uploadDocBtn && uploadModal) {
  uploadDocBtn.onclick = function(){
    new bootstrap.Modal(uploadModal).show();
  };
}
  </script>
</body>
</html>
